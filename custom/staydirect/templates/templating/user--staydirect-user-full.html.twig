{% extends get_module_path('templating') ~ "/templates/misc/user.html.twig" %}

{% block templating_content %}
	    {{ attach_library('staydirect/bootstrap') }}

	{% set item_name = 'user--staydirect-user-full.html' %}
	{% set path_css = directory ~ '/templates/templating/css/'~ item_name ~'.css' %}
	{% set css = include(path_css) %}
	{{render_css(css,'user__staydirect_user_full')}}

	{% set user = current_user() %}
	{% set u = user_parser(user['uid']) %}

	{%  set conditions = {
            'field_client': user['uid']
        } 
    %}

	{% set booking = node_parser_by_properties(conditions)%}


	<div class="container container-resp">
		<div class="row">
			<div class="col-lg-12">
				<div class="container--header">
					&nbsp;
				</div>
			</div>
		</div>
	</div>

	<div class="container-resp container container--right std--useradmin container--user user--profile--rectf user--container--table user--profile--rectf user--container--table--resp">
		<div class="row mb-2">

			<div class="col-lg-12 user--info" id="user-info">

				<div class="row useradmin--sidebar-left g-0  overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative affiche--dashboard">
					<div class="col p-4 d-flex flex-column position-static border rounded content--affiche--dashboard mz-bg-primary">
						<div class="container--spends">
							<div class="content--spend--affiche--dashboard">
								<h2 class="text-white text-start">Welcome {{user.name}}</h2>
								<p  class="text-white">Ready to start building website with StayDirect Technology ?</p>
							</div>
						</div>
					</div>
					<img class="img--affiche--dashboard" src="/themes/custom/staydirect/img/affiche-dashboarod.png">
				</div>
                <div class="row">
    				<div class="col-12 col-sm-12 col-md-4">
    				    <div class="mx-1 row useradmin--sidebar-left g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
    					    <div class="col p-4 d-flex flex-column position-static content--right">
    						<div class="container--spends">
    							<div class="content--spend">
    								<p>
    									Username :
    									{{user.name}}
    								</p>
    							</div>
    							<div class="content--spend">
    								<p>
    									Email :
    									{{u.mail}}
    								</p>
    							</div>
    							{% if u.field_first_name %}
    								<div class="content--spend">
    									<p>
    										Fisrt name :
    										{{u.field_first_name}}
    									</p>
    								</div>
    							{% endif %}
    							{% if u.field_last_name %}
    								<div class="content--spend">
    									<p>
    										Last name :
    										{{u.field_last_name}}
    									</p>
    								</div>
    							{% endif %}
    							{% if u.field_phone %}
    								<div class="content--spend">
    									<p>
    										Phone number :
    										{{u.field_phone}}
    									</p>
    								</div>
    							{% endif %}
    							<div>
    								<br/>
    								<p>
    									<a href="/user/{{u.uid}}/edit?destination=/user" class="btn-grey">
    										Edit profil
    									</a>
    								</p>
    							</div>
    
    						</div>
    					</div>
    					</div>
    				</div>
    
    				<div class="col-12 col-sm-12 col-md-8">
    				    <div class="mx-1 row g-0 border rounded overflow-hiddenn flex-md-row mb-4 shadow-sm h-md-250 position-relative history--product" id="history-product">
        					<div class="col p-4 d-flex flex-column position-static mySwiper content--table--history--booking" style="overflow-x: scroll !important;">
            						<style>
            							.badge {
            								display: inline-block;
            								font-weight: 700;
            								border-radius: 0.375rem;
            								text-align: center;
            								padding: 0.35em 0.65em;
            								white-space: nowrap;
            								color: #fff;
            								text-align: center;
            
            							}
            
            							.badge-inpaid {
            								background: #d2322d;
            							}
            							.badge-pending {
            								background: #ffc107;
            							}
            							.badge-paid {
            								background: #28a745;
            							}
            
            							.user--container--table .dropdown-menu {
            								width: 90% !important;
            								border-radius: 0 !important;
            								padding-top: 8px !important;
            								padding-bottom: 8px !important;
            								position: absolute;
            								transform: translate3d(0px, 35px, 0px);
            								top: 5px !important;
            								left: -64px !important;
            								will-change: transform;
            								font-size: 13px !important;
            							}
            							.user--container--table .btn {
            								padding: 5px14px5px15px !important;
            								width: 90% !important;
            
            							}
            						</style>
            						<table class="table table-striped">
            							<thead>
            								<tr>
            									<th scope="col">ID</th>
            									<th scope="col">Site </th>
                                                <th scope="col">created on
            									</th>
            									<th scope="col">Price</th>
            									<th scope="col">State</th>
            									<th scope="col"></th>
            								</tr>
            							</thead>
            							<tbody>
            								{% for item in booking|reverse %}
            									{% set n = node_parser(item) %}
            									{% set site = node_parser(n.field_item['#object']) %}
            									<tr>
            										<th scope="row">{{n.nid}}</th>
            										<td>{{ site.label_site}} ( <a href={{ site.field_st_domain_name}}>view site
            												</a> )</td>
                                                    <td>	{{n.created|date("Y-m-d")}} </td>
            
            										<td>
            											{% if n.moderation_state == "init" %}
            												<p class="text-center text-black">-</p>
            											{% else %}
            											    $
            											    {{n.field_price_with_tax}} 
            											{% endif %}
            										</td>
            										<td>
            											{% if n.moderation_state == "validate" %}
            												<span class="badge badge-paid">Booking Confirmed</span>
            											{% endif %}
            
            											{% if n.moderation_state == "draft" %}
            												<span class="badge badge-pending">Booking request validation</span>
            											{% endif %}
            											{% if n.moderation_state == "init" %}
            												<span class="badge badge-inpaid">wait for payment</span>
            											{% endif %}
            											{% if n.moderation_state == "published" %}
            												<span class="badge badge-inpaid">Archived</span>
            											{% endif %}
            
            										</td>
            										<td>
                                                    	<a class="dropdown-item" href="{{base_url}}/invoice?id={{n.nid}}">Get Invoice</a>
            										</td>
            									</tr>
            								{% endfor %}
            
            							</tbody>
            						</table>
        					</div>
        				</div>
    				</div>
                </div>
			</div>
		</div>
	</div>

{% endblock %}
